plugins {
    id "com.moowork.node" version "1.3.1"
}

node {
    version = '12.18.3'
    npmVersion = '6.14.7'
    download = true
}

task compileTypeScript(type: NpmTask, dependsOn: npmInstall) {
    args = ["run", "tsc"]
}

task copyRawFiles(type: Copy) {
    from 'src/raw'
    from 'CHANGELOG.markdown'
    into './build'
}

task assemble(dependsOn: [compileTypeScript, copyRawFiles])

task test(type: NpmTask, dependsOn: compileTypeScript) {
    args = ["test"]
}

task check(dependsOn: test)

task build(dependsOn: [assemble, check])

task clean(type: Delete) {
    delete './build'
}

task uploadTestCoverage(type: NpmTask, dependsOn: test) {
    args = ["run", "codecov"]
}

task npmPack(type: NpmTask, dependsOn: build) {
    args = ['pack', './build']
}

task npmPublish(type: NpmTask, dependsOn: build) {
    // See: https://docs.npmjs.com/cli/publish
    args = ['publish', './build']
}
